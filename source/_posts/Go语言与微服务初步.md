---
title: Go语言与微服务初步
description: Go语言的简单知识，以及简单微服务组件的概念和实现
categories: 开发
tags:
  - 微服务
  - Golang
index_img: /post_img/QQ20220528-084616@2x-2.png
banner_img: /post_img/QQ20220528-084616@2x-2.png
abbrlink: 57343
---

> 参考资料</br>
> 《Go语言高并发与微服务实战》；朱荣鑫，黄迪璇，张天；中国铁道出版社

## 云原生架构简介

> 云原生是在云的基础上提供了各种能力的一种方式

### 云计算

云计算可以说是云原生的基础。

云计算与计算机相伴相生，可以说计算机的多终端设计，特别是后期通过外部网络访问大型机这种方式粗略描绘出了云计算的基本形式。

但是云计算在2000年前后才真正快速发展起来，这主要是由虚拟化和容器技术的发展所决定。因此，我们可以认为的将云计算分为几个阶段

1. 虚拟化的出现
2. 虚拟化在云计算中的应用
3. 容器化的出现

#### 虚拟化与云计算

1955-1978年，学界确定了云计算所依赖的所有底层技术

- 操作系统，管理物理计算资源
- 虚拟化技术，将硬件资源分配给多个用户
- 互联网，及逆行远程接入

不过在这之后一段时间，分布式和小型机发展更为显眼。直到2001年，VMware带来X86虚拟化计划。

通常认为，2006年的亚马逊AWS代表云计算的到来。

在此之后，虚拟设备服务商提供计算资源的方式也逐渐出现分化。主要有三种模式

1. IaaS（Infrastructure as a Service），基础设施既是服务
2. SaaS（Software-as-a-Service），提供开箱即用的软件服务
3. PaaS（Platform-as-aService），直接提供软件部署平台

可以使用一个表格来展示它们之间的差异（1表示提供功能）

| 资源     | 传统IT | IaaS | SaaS | PaaS |
| -------- | ------ | ---- | ---- | ---- |
| 应用程序 | 0      | 0    | 0    | 1    |
| 数据     | 0      | 0    | 0    | 1    |
| 运行     | 0      | 0    | 1    | 1    |
| 中间件   | 0      | 0    | 1    | 1    |
| 操作系统 | 0      | 0    | 1    | 1    |
| 虚拟化   | 0      | 1    | 1    | 1    |
| 服务器   | 0      | 1    | 1    | 1    |
| 存储     | 0      | 1    | 1    | 1    |
| 网络     | 0      | 1    | 1    | 1    |

> 可以看得出来，比如阿里云的ECS服务器属于IaaS服务，使用者可以控制的最底层就是操作系统，其实这与使用一台物理机学习、开发差异并不大；一些Serveless服务大概应该归类为PaaS，提供了一个完整的、说走就走的运行环境

#### 容器化的到来

Docker是PaaS的经典开源产品，它带来了一次云计算的巨大革命，是具有里程碑意义的产品。

其实Docker是对虚拟化的一种实现，简单地说，虚拟化在硬件级别分离出不同的操作系统，容器化在操作系统层面分理处不同的硬件程序。容器化避免了虚拟出完整的操作系统，而是在操作系统的基础上进行一层容器化的隔离。

至于如何编排一台设备上的Docker、乃至众多物理机组成的容器集群就需要Kubernates这种容器编排工具。

如今，PaaS领域完全是Kubernates+Docker的天下。

### 云原生

#### 云原生究竟是什么

> 云原生是云计算的下半场。

云原生应当先被视作一种**基础设施**，运行在这些设施上的被称为“**云原生应用**”，符合云原生设计哲学的应用架构才叫做“**云原生应用架构**”。

互联网应用，特别是移动互联网的高速发展带来业务快速迭代、团队规模不断扩大降低沟通成本和加快交付速度的新要求，因此，微服务和云原生开始流行。

康威定律是微服务架构的理论基础，将单个服务分解为若干微服务，提高开发效率、迭代速度；云原生通过工具和方法减少更新导致的故障问题，保证服务的高可用。

根据Pivotal公司的概念，云原生应用架构应当有几个主要特征：符合12因素应用、面向微服务架构、敏捷架构、基于API的协作和康脆弱性。同时，他们提出云原生包含四个要点：DevOps、CI/CD、微服务架构和容器化。

云原生实际上是一种理念或者说方法论，云原生应用就是为了在云上运行而开发的应用。

目前，由Pivotal和Google共同建立的云原生计算基金会（Cloud Native Calculating Funcation，CNCF）成为事实上的云原生技术主要推动者

![CNCF landscape](https://jimmysong.io/kubernetes-handbook/images/006tNbRwly1fxmx633ymqj31dp0u0kjn.jpg)

#### 云原生的12因素

[参考链接，12因素](https://12factor.net)

方法论和核心思想。这是适用于所有后端程序的思想，主要为构建SaaS应用提出

1. 使用声明式格式搭建自动化
2. 降低对操作系统依赖，保持高移植性
3. 适配云平台部署
4. 最小化开发和生产之间的分歧，实现持续部署
5. 在工具架构不发生重大改变的情况下实现扩展

编码、部署和运维原则。12因素在三个方便提出具体的要求

1. 编码，Codebase、Build、release、run、Dev/prod parity
2. 部署，Dependencies、Config、Process、Backing services、Port binding
3. 运维，Concurrency、Disposability、Logs、Admin process··

### 云原生的基础架构

> 云原生既包含了实现应用云原生化的方法论，也包含了微服务、服务网格、容器、DevOps和声明式API等落地实践的关键性技术

- 微服务
  微服务旨在解决单体应用的复杂度问题。

- 容器
  容器旨在解决微服务架构下大量应用部署问题。
  容器技术具体涉及到运行时和编排技术两个层面，一个负责实现对具体应用的管理，另一个负责对大量应用进行维护。

- 服务网格
  Service Mesh主要实现了对应用的网络、IO操作的分离，进一步使应用专注于自身业务。

- DevOps
  DevOps旨在增加开发者和运维者之间的沟通，包含三个部分：开发、测试和运维。
  DevOps的一个重要特点是持续性，持续集成、持续测试、持续交付和持续部署，能够有效缩短开发周期、增加部署频率。

#### 关于CI/CD

CI/CD的具体内涵曾困扰了笔者许久。简单的说，传统应用开发的流程是比较完整、笨拙的，先完成所有开发然后测试、部署上线，CI/CD鼓励持续集成（开发完一部分就提上单元测试）、持续测试（集成测试结束就进入测试环境内测试）、持续部署（测试通过直接部署上线）。

其中“持续”两个字主要体现在这样的工作流程会使用CI/CD工具来代替人工管理。举个例子[<sup>1</sup>](#refer-anchor-1)

![持续集成](https://pica.zhimg.com/80/c5c8e6f40c7c133e22402c00bb7e1a25_1440w.jpg?source=1940ef5c)

持续集成强调开发人员提交了新代码之后，立刻进行构建、（单元）测试。根据测试结果，我们可以确定新代码和原有代码能否正确地集成在一起。

![持续交付](https://pic3.zhimg.com/80/db7198e3c39e4656e18efcb4bd1b20b1_1440w.jpg?source=1940ef5c)

持续交付在持续集成的基础上，将集成后的代码部署到更贴近真实运行环境的「类生产环境」（production-like environments）中。比如，我们完成单元测试后，可以把代码部署到连接数据库的 Staging 环境中更多的测试。如果代码没有问题，可以继续手动部署到生产环境中。

![持续部署](https://pica.zhimg.com/80/f96f19e4d567aad5006d841963a86e41_1440w.jpg?source=1940ef5c)

持续部署则是在持续交付的基础上，把部署到生产环境的过程自动化。

## 微服务概述

### 常见系统架构

#### 单体架构

传统Web开发通常将所有功能打包成一个jar或war包运行，缺点在于开发、拓展难度很大，而且不支持多语言技术栈。

#### 垂直分层架构

垂直架构将单体应用根据功能模块层级进行划分，各层之间通常使用网络接口通信。

MVC就是典型的分层模式。

#### SOA面向服务架构

垂直架构进一步拓展，会出现被多个服务同时依赖的单个服务，而且服务之间的沟通会变的异常繁多和复杂。

SOA架构做的最重要的一件事就是将功能模块抽象为服务，并保证服务的通用性，这使得一个服务可以同时向多个项目、多个团队乃至多个公司同时提供服务。在具体实现过程中，公司内通常会使用ESB企业服务总线进行沟通，同时提供一个服务管理基础架构（Service Management Infrastructure）进行服务的审核、列表、日志扽功能。

通常SOA架构被大公司拿来构建稳定、通用的大型公共API服务。

#### 微服务架构

简单来说，微服务架构相比SOA架构更关注单个服务的自洽性。

对于SOA服务架构来讲，很多应用是要依靠其他应用和一个ESB企业服务总线才能工作，共同构成一个完整的应用；微服务架构则希望这些应用自身就能独立运行。

因此，微服务架构更加轻量化，着重于分散管理、代码再利用与自动化执行。

![sda](https://www.dtstack.com/wp-content/uploads/2021/07/111.jpg)

#### 云原生架构

### 常见微服务框架

#### Spring Cloud

#### Dubbo

#### Go kit与Go Micro

### 微服务设计六大原则

1. 高内聚低耦合
2. 高度自治
3. 以业务为中心
4. 弹性设计
5. 日志与监控
6. 自动化

### 领域驱动设计

## 参考

<div id="refer-anchor-1"></div>

- [1] [如何理解持续集成、持续交付、持续部署？ - yumminhuang的回答 - 知乎](https://www.zhihu.com/question/23444990/answer/89426003)
